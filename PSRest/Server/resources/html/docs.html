<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Help</title>
    <link rel="icon" type="image/x-icon" href="resources/psrest.ico">
    <link rel="stylesheet" href="resources/colours.css" />
    <link rel="stylesheet" href="resources/code-colours.css" />
    <link rel="stylesheet" href="resources/code.css" />
    <style>
        body{
            font-family: Arial, Helvetica, sans-serif;
            margin: 0;
            margin-bottom: 0;
            background-color: var(--background);
            color: var(--text);
            line-height: 1.5;
        }

        .content a {
            color: var(--linkColour);
            font-weight: bold;
            text-decoration: none;
        }

        .content a:hover {
            border-bottom: 3px solid var(--linkColour);
        }

        .content {
            width: 85%;
            max-width: 1000px;
        }
        
        .content h1 {
            font-size: 3em;
            text-align: center;
        }

        .content h2 {
            font-size: 2em;
            margin-top: 1em;
            margin-bottom: 0.5em;
        }

        .content h3 {
            font-size: 1.5em;
            margin-top: 1em;
            margin-bottom: 0.5em;
        }

        .content h4 {
            font-size: 1.25em;
            margin-top: 1em;
            margin-bottom: 0.5em;
        }

        .content {
            margin-left: 200px;
            padding: 1px 16px;
            margin: auto;
        }

        .content li {
            margin-block: 1rem;
        }

        pre code{
            border-radius: 0.25rem;
            overflow-x: scroll;
        }

        .breakLine {
            margin-block: 2rem;
            border-bottom: 0.25rem solid var(--secondary);
        }

        section {
            background-color: var(--tertiary);
            padding: 1rem;
            border-radius: 0.5rem;
        }

        .sidebar {
            height: 100%;
            min-width: 4.5%;
            position: fixed;
            z-index: 1;
            top: 0;
            left: 0;
            background-color: var(--tertiary);
            overflow-x: hidden;
            padding-top: 20px;
            scrollbar-width: none;
            font-weight: bold;
        } 

        .sidebar::-webkit-scrollbar {
            display: none;
        }

        .sidebar:hover {
            background-color: var(--primary);
            background-image: none;
            cursor: pointer;
        }

        #index {
            list-style-type: none;  
            display: none;
            text-decoration: none;
            padding: 0;
            padding: 3rem;
        }

        #index ul {
            list-style-type: disc;
        }

        #index li {
            margin-block: 0.5rem;
        }

        #index a {
            display: block;
            color: var(--text);
            padding: 16px;
            text-decoration: none;
            cursor: pointer;
        }

        #index a:hover {
            color: var(--text);
            font-weight: bold;
            color: var(--linkColour);

        }
    </style>
</head>
<body>

    <div id="sidebar" class="sidebar" onclick="toggleSideBar()">
        <ul id="index">
            <li><a href="./">Home</a></li>
            <li><a href="#about">About</a></li>
            <li><a href="#gettingStarted">Getting Started</a></li>
            <li><a href="#config">Configuration</a>
                <ul>
                    <li><a href="#configCmdlets">Config Cmdlets</a></li>
                    <li><a href="#configFile">Config File</a></li>
                </ul>
            </li>
            <li><a href="#applications">Applications</a>
                <ul>
                    <li><a href="#createApplication">Create Application</a></li>
                    <li><a href="#modifyApplication">Modify Application</a></li>
                </ul>
            </li>
            <li><a href="#authentication">Authentication</a>
                <ul>
                    <li><a href="#clientCredential">Client Credential</a></li>
                    <li><a href="#refreshToken">Refresh Token</a></li>
                    <li><a href="#psrestConsole">PSRest Console</a></li>
                </ul>
            </li>
            <li><a href="#run">Run Commands</a>
                <ul>
                    <li><a href="#runHeaders">Headers</a></li>
                    <li><a href="#runRequestBody">Request Body</a></li>
                </ul>
            </li>
        </ul>
    </div>
    <div class="container" onclick="clearSideBar()">
    <div class="content">
        <h1>Documentation</h1>
        <p>
            If you like using PSrest consider donating to help support the project. Visit <a href="https://psrest.com/donate">psrest.com</a> to donate and
            learn more.
        </p>
        <h2 id="gettingStarted">Getting started</h2>
        <section class="gettingStarted">
            <p>
                PSRest is a Powershell module that allows you to run Powershell commands via a REST API. PSRest is designed to be used as a REST API
                for Powershell, allowing you to run Powershell commands from any language or source that can make HTTP requests. PSRest is designed to be used
                as a REST API for Powershell. If you need more information about PSRest you can find it on the <a href="https://psrest.com">PSRest website</a>.
            </p>
            <h3 id="install">Install</h3>
            <p>
                PSRest can be installed from the Powershell Gallery using the following command:
            </p>
            <pre><code class="language-powershell">Install-Module -Name PSRest</code></pre>
        </section>
        <h2 id="config">Configuration</h2>
        <section class="configuration">
            <P>
                PSRest offers a number of configuration options to allow you to alter the behaviour of the application. There are two ways to configure
                PSRest, using the Powershell Cmdlets packaged with PSRest or by editing the config file directly.
            </p>
            <h3 id="configCmdlets">Config Cmdlets</h3>
            <p>
                PSRest comes with a number of cmdlets that allow you to configure PSRest. These cmdlets are:
            </p>
            <ul>
                <li><code class="token"><a href="help/Get-PSRestConfiguration">Get-PSRestConfiguration</a></code></li>
                <li><code class="token"><a href="help/Set-PSRestConfiguration">Set-PSRestConfiguration</a></code></li>
            </ul>
            <p>
                The <code class="token">Get-PSRestConfiguration</code> cmdlet allows you to view the current configuration of PSRest. Here is an example of how to use it:
            </p>
            <pre><code class="language-powershell">Get-PSRestConfiguration</code></pre>
            <pre><code class="language-shell">Port              : 80
SSLCertificate    : 
SSLKeyFile        : 
SSLCiphers        : 
DefaultTTL        : 5
MaxTTL            : 900
StrictTTL         : False
ArbitraryCommands : False
Help              : True
Docs              : True
DefaultDepth      : 4
StrictDepth       : False</code>
            </pre>
            <p>
                The <code class="token">Set-PSRestConfiguration</code> cmdlet allows you to modify the configuration of PSRest. To learn what each parameter does
                check out the <a href="#configFile">config file</a> section, or read the <a href="help/Set-PSRestConfiguration">help</a> page for the cmdlet.
            </p>
            <pre><code class="language-powershell">Set-PSRestConfiguration -Port 443 -SSLCertificate "&lt;certifcate_path&gt;" -SSLKeyFile "&lt;certifcate_path&gt;" -SSLCiphers "TLSv1.2" -DefaultTTL 10</code></pre>
            <p>
                After running the above command the <code class="token">Get-PSRestConfiguration</code> cmdlet will return the following:
            </p>
            <pre><code class="language-shell">Port              : 443
SSLCertificate    : &lt;certifcate_path&gt;                         
SSLKeyFile        : &lt;certifcate_path&gt;
SSLCiphers        : TLSv1.2
DefaultTTL        : 10
MaxTTL            : 900
StrictTTL         : False
ArbitraryCommands : False
Help              : True
Docs              : True
DefaultDepth      : 4
StrictDepth       : False</code></pre>
            <h3 id="configFile">Config file</h3>
            <p>
                The config file is a JSON file that can be found in the following locations depending on your operating system:
            </p>
            <ul>
                <li>Windows: <code class="token">%AppData%\PSRest\config.json</code></li>
                <li>MacOS: <code class="token">~/.config/PSRest/config.json</code></li>
                <li>Linux: <code class="token">~/Library/Application Support/PSRest</code></li>
            </ul>
            <p>
                It's location is relative to the user that is running PSRest. If you are running PSRest as a service then the config file will be located
                in the home directory of the user that is running PSRest.
            </p>
            <p>
                The config contains all the configuration options that PSRest supports. The config file is loaded when PSRest starts and any changes made
                to the config file will not take effect until PSRest is restarted. Below is an example showing the contents of the config file:
            </p>
            <pre><code class="language-json">{
    "Port": 443,
    "SSLCertificate": "&lt;certifcate_path&gt;",
    "SSLKeyFile": "&lt;certifcate_path&gt;",
    "SSLCiphers": "TLSv1.2",
    "DefaultTTL": 5,
    "MaxTTL": 900,
    "StrictTTL": false,
    "Help": true,
    "Docs": true,
    "DefaultDepth": 4,
    "StrictDepth": false,
    "ArbitraryCommands": false
}</code></pre>
            <p>
                The config file contains the following options:
            </p>
            <h4 id="Port">Port</h4>
            <p>
                The <code class="token">Port</code> option allows you to specify the port PSRest will listen on. The value must be a valid port number
                i.e between 1 and 65535. This option is mandatory and if not set PSRest will not start.
            </p>
            <h4 id="SSLCertificate">SSL Certificate</h4>
            <p>
                <code class="token">SSLCertificate</code> is an optional option, when this option is set PSRest will use only work with HTTPS and
                will not accept HTTP requests. The value of this option must be a valid path to a certificate file. If this option is not set PSRest
                will work with only HTTP and will not accept HTTPS requests.
            </p>
            <h4 id="SSLKeyFile">SSL Key File</h4>
            <p>
                <code class="token">SSLKeyFile</code> is an optional option, that is dependent on the <code class="token">SSLCertificate</code> option being set.
                When this option is set PSRest will use only work with HTTPS and will not accept HTTP requests. The value of this option must be a valid
                path to a key file. If this option is not set PSRest will work with only HTTP and will not accept HTTPS requests.
            </p>

            <p>
                If your Key file has a password in order to use it with PSRest you will need to create an environment variable called
                <code class="token">PSRestSSLKeyFilePassword</code>. 
            </p>
            <h4 id="SSLCiphers">SSL Ciphers</h4>
            <p>
                <code class="token">SSLCiphers</code> is an optional option, and is dependent on the <code class="token">SSLCertificate</code> and the
                <code class="token">SSLKeyFile</code> options being set. This allows you to specify the ciphers PSRest will use when handling PSRest will use
                when handling HTTPS requests. The value of this option must be a valid cipher string. If this option is not set PSRest will use the default
                <code>TLSv1.2</code>.
            <h4 id="DefaultTTL">Default TTL</h4>
            <p>
                <code class="token">DefaultTTL</code> is a mandatory option that allows you to specify the default time to live for a command
                that is run by PSRest. If a user does not specify a TTL when running a command via PSRest then the command will run for the amount of time
                specified by this option. The value of this option must be a whole number between 1 and the value of the <code class="token">MaxTTL</code>
                option. 
            </p>
            <p>
                The value represents the number of seconds that a command can run for. If the value is set to 1 then the command must complete within
                1 second or it will be terminated. And the user will be returned a timeout error.
            </p>
            <h4 id="MaxTTL">Max TTL</h4>
            <p>
                <code class="token">MaxTTL</code> is a mandatory option that allows you to specify the maximum time to live for a command a user
                can specify when running a command via PSRest. This is useful if you want to limit the amount of time that a command can run for. ie 
                not allow commands to take longer than 5 minutes for example.
            </p>
            <h4 id="StrictTTL">Strict TTL</h4>
            <p>
                <code class="token">StrictTTL</code> is a mandatory option that allows you to specify whether or not PSRest should or should not allow a
                user to specify a custom TTL when executing commands. If this option is enabled, PSRest will not allow a user to specify a TTL when running
                a command and commands will only be able to run as long as defined by the <code class="token">DefaultTTL</code>.
            </p>
            <p>
                If this option is disabled
                then PSRest will allow a user to define a TTL for their command upto the maximum TTL defined by the <code class="token">MaxTTL</code> option.
            </p>
            <h4 id="Help">Help</h4>
            <p>
                <code class="token">Help</code> is a mandatory option when this is enabled, i.e set to true, PSRest will automatically generate a help page
                for all commands that can be run by PSRest.
            </p>
            <p>    These help pages can be found at the following URL:
                <code class="token">&lt;psrest server&gt;/help/&lt;cmdlet name&gt;</code> these help pages produce the same output
                as the <code class="token">Get-Help</code> cmdlet in Powershell with the <code class="token">Full</code> swicth enabled.
            </p>
            <p>
                These help pages offer a great way to document how to use commands you decide to expose via PSRest, allowing others to learn how to use your
                commands without having to read the source code or directly ask you for support.
            </p>
            <h4 id="Docs">Docs</h4>
            <p>
                <code class="token">Docs</code> is a mandatory option when enabled this documentation page you are reading right now is made available,
                allowing you and others to learn how to use PSRest and how to configure it. 
            </p>
            <h4 id="Depth">Default Depth</h4>
            <p>
                All cmdlet output returned by PSRest when using the <code class="token">/run</code> endpoint are JSON responses, <code class="token">DefaultDepth</code>
                is a mandatory option that allows you to specify the default depth that PSRest will use when converting cmdlet responses to json.
            </p>
            <p>
                This stops PSRest from returning a huge JSON response which are quite common when converting powershell objects to json
                when you only want a small amount of data. By default <code class="token">DefaultDepth</code> is set to 4, which means that only the first
                4 levels of nested data in the object will be returned.
            </p>
            <p>
                Anything deeper than this will be replaced with a <b>Powershell property description</b> of the data to indicate that there is more data available.
                If a user wants to see the data that is deeper than the <code class="token">DefaultDepth</code> they can specify a depth when running a command.
            </p>
            <h4 id="StrictDepth">Strict Depth</h4>
            <p>
                <code class="token">StrictDepth</code> is a mandatory boolean option, when set to true,PSRest will only return convert the responses generated
                by powershell cmdlets to the depth level specified by the <code class="token">DefaultDepth</code> option and will ignore any depth specified by
                the user when running a command.
            </p>
            <h4 id="ArbitraryCommands">Arbitrary Commands</h4>
            <p>
                <code class="token">ArbitraryCommands</code> is a mandatory boolean option, when set to true PSRest will stop sanitizing cmdlets it recieves. 
                Whatever raw cmdlet a user passes to PSRest will be run regardless of whether or not the application has been configured to allow that cmdlet
                to be run. This also allows you to escape strings and pipe cmdlets together.
            </p>
            <p>
                This is highly dangerous and should only be enabled if you know what you are doing.
            </p>
        </section>
        <h2 id="applications">Applications</h2>
        <section class="applications">
            <p>
                PSRest allows you to create client applications, these applications are able to authenticate with PSRest and run a limited set of
                predefined cmdlets. This allows you to limit what a given application can do when using PSRest. This is useful for preventing
                applications from running commands the PSRest administrator does not want them to run.
            </p>
            <p>
                When creating a new client application you can choose the authentication method that the application will use to authenticate with PSRest.
                There are two authentication methods that can be used, <code class="token"><a href="#clientCredential">client_credential</a></code> and
                <code class="token">access_token</a></code>. When a new client application is created a <code class="token">client_id</code> and
                <code class="token">client_secret</code> are generated for that client application or an <code class="token">access_token</code> is generated
                depending on the authentication method you choose.
            </p>
            <p>
                Creating, modifying and removing, viewing applications can be done via a few simple cmdlets packaged with PSRest.
            </p>
            <ul>
                <li><code class="token"><a href="help/New-PSRestApplication">New-PSRestApplication</a></code></li>
                <li><code class="token"><a href="help/Set-PSRestApplication">Set-PSRestApplication</a></code></li>
                <li><code class="token"><a href="help/Get-PSRestApplication">Get-PSRestApplication</a></code></li>
                <li><code class="token"><a href="help/Remove-PSRestApplication">Remove-PSRestApplication</a></code></li>
            </ul>
            <h3 id="createApplication">Create a new application</h3>
            <p>
                Creating a new application can be done using the <code class="token">New-PSRestApplication</code> cmdlet. Here is an example of how to
                use it. 
            </p>
            <pre><code class="language-powershell">New-PSRestApplication -Name "Example" -Description "An example to showcase PSRest" -Authentication "client_credential" -EnabledCmdlets "Get-Item", "Remove-Item"</code></pre>
            <pre><code class="language-shell">client_id                            client_secret
---------                            -------------
1c6b246d-54bc-4d4b-9cb4-282dc9acaf5b 741c43b5-fb67-4a94-9495-f987e8c0922f</code></pre>
            <p>
                When authentication is set to <code class="token">access_token</code> an <code class="token">access_token</code> is provided. The token
                is valid for 1 year and there is no way to get the token again so make sure you save it somewhere safe.
            </p>
            <pre><code class="language-powershell">New-PSRestApplication -Name "Example2" -Description "An example to showcase PSRest with access_token authentication" -Authentication "access_token" -EnabledModules "PSReadLine" -DisabledModuleCmdlets "Set-PSReadLineOption", "PSConsoleHostReadLine"</code></pre>
            <pre><code class="language-shell">access_token
------------
eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJyZWZlcmVuY2UiOjEzLCJleHBpcnkiOjE3MzUwODU4MjguMjc2NTcyfQ.fNKOT1LXHFwgduq7P1NvySeW1ddMhhB23uh35PAItU3uD3aS2ONpVg0C03xytlAccvFaSaiJinY7_wsvLWJXTQ</code></pre>
            <p>
                By using the <code class="token">Get-PSRestApplication</code> cmdlet you can view all the applications that have been created. And what
                cmdlets they are allowed to run. Here is an example of how to use it.
            </p>
            <pre><code class="language-powershell">Get-PSRestApplication</code></pre>
            <pre><code class="language-shell">Id                    : 1
ApplicationName       : Example
Description           : An example to showcase PSRest
EnabledCmdlets        : {Get-Item, Remove-Item}
DisabledModuleCmdlets : {}
EnabledModules        : {}
Cmdlets               : {Get-Item, Remove-Item}

Id                    : 2
ApplicationName       : Example2
Description           : An example to showcase PSRest with access_token authentication
EnabledCmdlets        : {}
DisabledModuleCmdlets : {Set-PSReadLineOption, PSConsoleHostReadLine}
EnabledModules        : {PSReadLine}
Cmdlets               : {Get-PSReadLineKeyHandler, Get-PSReadLineOption, Remove-PSReadLineKeyHandler, Set-PSReadLineKeyHandler}</code></pre>
            <p>
                Cmdlets is a list of all the cmdlets that the application is allowed to run. This list is the union of the cmdlets in the
                <code class="token">EnabledCmdlets</code> and all the exported cmdlets in the modules specified in the <code class="token">EnabledModules</code>
                property minus the cmdlets in the <code class="token">DisabledModuleCmdlets</code> property.
            </p>
            <h3 id="modifyApplication">Modify an application</h3>
            <p>
                Using the <code class="token">Set-PSRestApplication</code> cmdlet you can modify an existing client application. This allows you
                to modify the cmdlets a given application can run and it's description. 
            </p>
            <p>
                It's worth noting any changes made to an application will not take effect until PSRest is restarted.
            </p>
            <pre><code class="language-powershell">Set-PSRestApplication -Name "Example" -Description "A new description" -EnabledModules "PSReadLine"</code></pre>
            <pre><code class="language-powershell">Get-PSRestApplication -Name "Example"</code></pre>
            <pre><code class="language-shell">Id                    : 1
ApplicationName       : Example
Description           : A new description
EnabledCmdlets        : {Get-Item, Remove-Item}
DisabledModuleCmdlets : {}
EnabledModules        : {PSReadLine}
Cmdlets               : {Get-Item, Remove-Item, Get-PSReadLineKeyHandler, Get-PSReadLineOption, Remove-PSReadLineKeyHandler, Set-PSReadLineKeyHandler, Set-PSReadLineOption}</code></pre>
            <p>
                You can also remove a given application using the <code class="token">Remove-PSRestApplication</code> cmdlet.
            </p>
            <pre><code class="language-powershell">Remove-PSRestApplication -Name "Example"</code></pre>
        </section>
        <h2 id="authentication">Authentication</h2>
        <section class="authentication">
            <p>
                The <code class="token">/oauth</code> endpoint is used to authenticate a user and provide them an <code class="token">access_token</code> when
                the authentication attempt is successful.
            </p>
            <p>
                There are 3 ways to get an <code class="token">access_token</code>:
            </p>
            <h3 id="clientCredential">Client Credential</h3>
            <p>
                When a new client application is created a <code class="token">client_id</code> and <code class="token">client_secret</code> are generated for
                that client application. These credentials can be used to authenticate the client application and generate an
                <code class="token">access_token</code>. To learn more about creating a client application with PSRest check out the
                <a href="#applications">applications</a> section.
            </p>
            <p>
                Below is an example of how to authenticate a client application using the <code class="token">client_credential</code> method with
                <b>Invoke-WebRequest</b> and <b>Curl</b>.
            </p>
            <h4>Headers</h4>
            <pre><code class="language-yaml">Content-Type: application/json</code></pre>
            <h4>Request Body</h4>
            <pre><code class="language-json">{
    "grant_type": "client_credentials",
    "client_id": "&lt;client_id&gt;",
    "client_secret": "&lt;client_secret&gt;"
}</code></pre>
                <h4>Example</h4>
                <pre><code class="language-powershell">$body = @{
    "grant_type" = "client_credentials";
    "client_id" = "&lt;client_id&gt;";
    "client_secret" = "&lt;client_secret&gt;";
}

Invoke-WebRequest -Uri http://&lt;psrest_server&gt;/oauth -Method POST -Body $body</code></pre>
                <pre><code class="language-shell">curl -X POST http://&lt;psrest_server&gt;/oauth \
    -H "Content-Type: application/json" \
    -d '{"grant_type":"client_credentials", "client_id":"&lt;client_id&gt;", "client_secret":"&lt;client_secret&gt;"}'</code></pre>
                <h4>Response</h4>
                <pre><code class="language-json">{
    "access_token": "&lt;access_token&gt;",
    "expires_in": 3600,
    "refresh_token": "&lt;refresh_token&gt;" 
}</code></pre>
                <p>
                    <b>Note:</b> the <code class="token">expires_in</code> property is the number of seconds that the <code class="token">access_token</code> is valid for.
                </p>
                <div class="breakLine"></div>
                <h3 id="refreshToken">Refresh Token</h3>
                <p>
                    When a user authenticates with PSRest using the <code class="token"><a href="#clientCredential">client_credential</a></code> method, a <code class="token">refresh_token</code>
                    is also generated. This <code class="token">refresh_token</code> can be used to authenticate a user and generate a new
                    <code class="token">access_token</code> when the <code class="token">access_token</code> expires. The <code class="token">refresh_token</code>
                    is valid for 14 days after it is generated.
                </p>
                <p>
                    Below is an example of how to authenticate a user using the <code class="token">refresh_token</code> method with <b>Invoke-WebRequest</b> and <b>Curl</b>.
                </p>
                <h4>Headers</h4>
                <pre><code class="language-yaml">Content-Type: application/json</code></pre>
                <h4>Request Body</h4>
                <pre><code class="language-json">{
    "grant_type": "refresh_token",
    "refresh_token": "&lt;refresh_token&gt;"
}</code></pre>
                <h4>Example</h4>
                <pre><code class="language-powershell">$body = @{
    "grant_type" = "refresh_token";
    "refresh_token" = "&lt;refresh_token&gt;";
}

Invoke-WebRequest -Uri http://&lt;psrest_server&gt;/oauth -Method POST -Body $body</code></pre>
                <pre><code class="language-shell">curl -X POST http://&lt;psrest_server&gt;/oauth \
    -H "Content-Type: application/json" \
    -d '{"grant_type":"refresh_token", "refresh_token":"&lt;refresh_token&gt;"}'</code></pre>
                <h4>Response</h4>
                <pre><code class="language-json">{
    "access_token": "&lt;access_token&gt;",
    "expires_in": 3600,
    "refresh_token": "&lt;refresh_token&gt;"
}</code></pre>
                <p>
                    <b>Note:</b> the <code class="token">expires_in</code> property is the number of seconds that the <code class="token">access_token</code> is valid for.
                </p>
                <div class="breakLine"></div>
                <h3 id="psrestConsole">PSRest Console</h3>
                <p>
                    When creating a new client application for PSRest you can specify if you want to generate a <code class="token">client_id</code> and
                    <code class="token">client_secret</code> or if you want to generate an <code class="token">access_token</code> for the
                    client application. If you choose to generate an <code class="token">access_token</code> the console will generate an access token for you
                    and display it in the console. This access token can then be used to authenticate with PSRest for 1 year.
                </p>
                <p>
                    For security reasons the 1 year <code class="token">access_token</code> method is ill-advised and you should use the
                    <code class="token"><a href="#clientCredential">client_credential</a></code> method.
                </p>
                <p>
                    Check out the <a href="#applications">applications</a> section to learn more about creating a new client application for PSRest.
                </p>
        </section>
        <h2 id="run">Run Commands</h2>
        <section class="run">
            <p>
                The <code class="token">/run</code> endpoint is the main endpoint for PSRest. This endpoint allows you to run Powershell commands via a HTTP post
                request. What commands you can run is limited to those authorised for your <code class="token">access_token</code>. Check out the
                <a href="#authentication">authentication</a> section to learn how to get an <code class="token">access_token</code> and
                <a href="#applications">applications</a> to learn how to authorise a set of cmdlets for a given application. 
            </p>
            <h3 id="runHeaders">Headers</h3>
            <p>
                Listed below are the headers that are used by the <code class="token">/run</code> endpoint.
            </p>
            <pre><code class="language-yaml">Authorization: Bearer &lt;access_token&gt;
Content-Type: application/json
Depth: &lt;int&gt;
TTL: &lt;int&gt;</code></pre>
            <ul>
                <li>
                    <code class="token"><b>Authorization</b></code> - This is a mandatory header. It should consist of the string <code class="token string">"Bearer "</code>
                    followed by the <code class="token">access_token</code> string.
                </li>
                <li>
                    <code class="token"><b>Content-Type</b></code> - This is a mandatory header and should always be set to <code class="token string">"application/json"</code>
                    when making requests to the <code class="token">/run</code> endpoint, the endpoint only supports JSON requests.
                </li>
                <li>
                    <code class="token"><b>Depth</b></code> - This is used to tell PSRest how deep to go when converting the output of a cmdlet to JSON. This
                    header is optional and if not set it will default to the value of the <code class="token"><a href="#configDefaultDepth">DefaultDepth</a></code>
                    option in the <a href="#config">config</a>. The value of this header must be a whole number between 0 and the value of the
                    <code class="token"><a href="#configMaxDepth">MaxDepth</a></code> option in the Config.
                </li> 
                <li>
                    <code class="token"><b>TTL</b></code> - This is used to tell PSRest how long to allow a command to run for before timing out. This header
                    is optional and if not set will default to the value of the <code class="token"><a href="#configDefaultTTL">DefaultTTL</a></code></a>
                    option in the config file. If the <code class="token"><a href="#configStrictTTL">StrictTTL</a></code> option is enabled in
                    the config file then this header will be ignored and the <code class="token"><a href="#configDefaultTTL">DefaultTTL</a></code>
                    option will be used.
                </li>
            </ul>
            <h3 id="runRequestBody">Request Body</h3>
            <p>
                The request body sent must be a valid JSON object, here is an example that uses named parameters:
            </p>
            <pre><code class="language-json">{
    "cmdlet": "&lt;Verb-Noun&gt;",
    "parameters": {
        "&lt;param1&gt;": "value",
        "&lt;param2&gt;": 1,
        "&lt;param3&gt;": [],
        "&lt;param4&gt;": {},
        "&lt;param5&gt;": null,
        "&lt;param6&gt;": true,
        ...
    },
    "array_wrap" : true;
}</code></pre>
            <ul>
                <li>
                    <code class="token"><b>cmdlet</b></code> - This is a mandatory property on the JSON object. The value of this property must be a string and
                    should be the name of the cmdlet you want to run or the name of an installed powershell script. Using the filepath of a powershell script
                    will not work.
                </li>
                <li>
                    <p>
                        <code class="token"><b>parameters</b></code> - This is an optional property on the JSON object. The value of this property must be a
                        JSON object or array.
                    </p>
                    <p>
                        If the value of this property is an object, the properties of the object must be the name of the parameters you want to pass to the cmdlet
                        and the value of the property must be the value you want to pass to the cmdlet. The value of the property can be any valid JSON data type.
                    </p>
                    <p>
                        If the value of this property is an array, the values of the array are passed as positional parameters to the cmdlet in the order they
                        appear in the array. The values of the array can be any valid JSON data type. An example is shown below:
                    </p>
                    <pre><code class="language-json">{
    "cmdlet": "&lt;Verb-Noun&gt;", 
    "parameters": [
        "value",
        1,
        [],
        {},
        null,
        true
        ...
    ],
}</code></pre>
                    <p>
                        If the cmdlet you are running does not require any parameters then you do not need to specify this property. You can also specify this
                        property as an empty object or array if you want to be explicit that you are not passing any parameters to the cmdlet. An example is
                        shown below:
                    </p>
                    <pre><code class="language-json">{
    "cmdlet": "&lt;Verb-Noun&gt;",
}</code></pre>
                    <p>
                        <b>NOTE:</b> If the value of a given parameter is an object it will be passed as a <code class="token">PSCustomObject</code> to that parameter.
                        A <code class="token">String</code> value is also passed as literal string to the cmdlet so you can't use a variable or expression
                        as a parameter value. 
                    </p>
                <li>
                    <p>
                        <code class="token"><b>array_wrap</b></code> - This is an optional property on the JSON object. The value of this property must be a boolean
                        value if the property is not set PSRest will use <code class="token">false</code> when processing the request.
                    </p>
                    <p>
                        When set to <code class="token">true</code> the value of the <code class="token">data</code> property in the JSON response will always be
                        an array. For cmdlets that return a single non array value the result is wrapped in an array. For cmdlets that already return an array
                        the result is not wrapped. 
                    </p>
                    <p>
                        When set to <code class="token">false</code> the value of the <code class="token">data</code> property in the JSON response can be any
                        valid JSON data type. 
                    </p>
                </li>
            </ul>
            <h3>Examples</h3>
            <p>
                Below are some examples of how to use the <code class="token">/run</code> endpoint using both <b>Invoke-WebRequest</b> and <b>Curl</b>.
            <b><p>Example 1</p></b>
            <pre><code class="language-powershell">$headers = @{"Authorization": "Bearer &lt;access_token&gt;"}
$body = @{
    "cmdlet" = "Get-Date";
} | ConvertTo-Json

Invoke-WebRequest -Uri http://&lt;psrest_server&gt;/run -Method POST -Body $body -ContentType "application/json" -Headers $headers</code></pre>
            <pre><code class="language-shell">curl -X POST  http://&lt;psrest_server&gt;/run \
    -H "Content-Type: application/json" \
    -H "Authorization: Bearer <access_token>" \
    -d '{"command":"Get-Date"}'</code></pre>
            <b><p>Response</p></b>
            <pre><code class="language-json">{
    "data": {
        "value":  "\/Date(1703366724837)\/",
        "DisplayHint":  2,
        "DateTime":  "23 December 2023 21:25:24"
    }
    "error": null,
}</code></pre>
            <div class="breakLine"></div>
            <b><p>Example 2</p></b>
            <pre><code class="language-powershell">$headers = @{"Authorization": "Bearer &lt;access_token&gt;"}
$body = @{
    "cmdlet" = "Get-Date";
    "parameters" = @{
        "Date" = "01/01/2024"
    }
} | ConvertTo-Json

Invoke-WebRequest -Uri http://&lt;psrest_server&gt;/run -Method POST -Body $body -ContentType "application/json" -Headers $headers</code></pre>
            <pre><code class="language-shell">curl -X POST  http://&lt;psrest_server&gt;/run \
    -H "Content-Type: application/json" \
    -H "Authorization: Bearer <access_token>" \
    -d '{"command":"Get-Date", "parameters": {"Date": "01/01/2024"}}'</code></pre>
            <b><p>Response</p></b>
            <pre><code class="language-json">{
    "data": {
        "value":  "\/Date(1704067200000)\/",
        "DisplayHint":  2,
        "DateTime":  "01 January 2024 00:00:00"
    }
    "error": null,
}</code></pre>
            <div class="breakLine"></div>
            <b><p>Example 3</p></b>
            <pre><code class="language-powershell">$headers = @{"Authorization": "Bearer &lt;access_token&gt;"}
$body = @{
    "cmdlet" = "Get-UpTime";
    "parameters" = ["01/12/2024"];
    "array_wrap" = true;
} | ConvertTo-Json

Invoke-WebRequest -Uri http://&lt;psrest_server&gt;/run -Method POST -Body $body -ContentType "application/json" -Headers $headers</code></pre>
            <pre><code class="language-shell">curl -X POST http://&lt;psrest_server&gt;/run \
    -H "Content-Type: application/json" \
    -H "Authorization: Bearer &lt;access_token&gt;" \
    -d '{"command":"Get-Date", "parameters": ["01/12/2024"]}'</code></pre>
            <b><p>Response</p></b>
            <pre><code class="language-json">{
    "data": [
        {
            "value":  "\/Date(1733011200000)\/",
            "DisplayHint":  2,
            "DateTime":  "01 December 2024 00:00:00"
        }
    ]
    "error": null,
}</code></pre>
        </section>
        <h2 id="about">About</h2>
        <section class="about">
            <p>
                PSRest is an application that allows you to run Powershell commands via a REST API. Allowing you to connect anything that can speak HTTP to Powershell.
                PSRest was created by Leenton in 2022. To learn about licensing check out the <a href="https://psrest.com/license">license</a> page
                on the PSRest website.
            </p>
            <p>
                If you have any queries and want to get in touch or need help send an email to <a href="mailto:howdy@psrest.com">howdy@psrest.com</a> or join send a "toot" to 
                <a href="https://mastodon.social/@leenton">@leenton</a> on Mastodon.
            </p>
            <p>
                To learn more about new versions of psrest check out the <a href="https://psrest.com/changelog">changelog</a> page on the PSRest website.
            </p>
        </section>
    </div>
    </div>
</body>
<script src="resources/highlight.js"></script>
<script src="resources/powershell.js"></script>
<script src="resources/json.js"></script>
<script>
  hljs.highlightAll();
</script>
<script>
    function toggleSideBar() {
        var id = document.getElementById("index");
        if (id.style.display == "none" || id.style.display == "") {
            id.style.display = "block";
            sidebar.onclick = function() { clearSideBar(); };
        }
    }

    function clearSideBar() {
        sidebar.onclick = function() { toggleSideBar(); }; 
        var id = document.getElementById("index");
        if (id.style.display == "block") {
            id.style.display = "none";
        }
    }
</script>
</html>